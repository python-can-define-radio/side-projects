<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Three.js – Capsule + Octree FPS</title>
    <link rel="stylesheet" href=__insert_game_name_here__.css>
</head>

<body>
    <div id="reticule">
        <span></span>
        <span></span>
    </div>
    <div id="hud" style="position:fixed; top:10px; left:10px; color:white; font-family:monospace;">
        <div id="usernameHud" style="margin-bottom:6px; font-weight:bold;"></div>
        <div>FPS: <span id="fpsCounter">--</span></div>
        Yaw: <span id="yawtext"></span><br>
        Pos:
        <span style="color:#ed8711;">X:</span> <span id="posx"></span>
        <span style="color:#d2ef1b; margin-left:6px;">Y:</span> <span id="posy"></span>
        <span style="color:#4488ff; margin-left:6px;">Z:</span> <span id="posz"></span>
        <div id="pyodideStatus" style="margin-top:6px; color:#aaa;">Pyodide: loading…</div>
    </div>
    <div id="barContainer">
        <div id="bar">
            <div class="label">N</div>
            <div class="label">NE</div>
            <div class="label">E</div>
            <div class="label">SE</div>
            <div class="label">S</div>
            <div class="label">SW</div>
            <div class="label">W</div>
            <div class="label">NW</div>
            <div class="label">N</div>
            <div class="label">NE</div>
            <div class="label">E</div>
            <div class="label">SE</div>
            <div class="label">S</div>
            <div class="label">SW</div>
            <div class="label">W</div>
            <div class="label">NW</div>
            <div class="label">N</div>
            <div class="label">NE</div>
            <div class="label">E</div>
            <div class="label">SE</div>
            <div class="label">S</div>
            <div class="label">SW</div>
            <div class="label">W</div>
            <div class="label">NW</div>
        </div>
        <div id="triangle"></div>
    </div>
    <div id="startScreen">
        <div id="startPanel">
            <h1>Start Game</h1>
            <label>
                Username
                <input id="usernameInput" type="text" maxlength="16" placeholder="Player1">
            </label>
            <div class="avatarSelect">
                <p>Avatar</p>
                <div class="avatarPreview">
                    Capsule + Sphere
                </div>
                <small>(More avatars coming later)</small>
            </div>
            <button id="startButton" class="menuButton start">Start Game</button>
            <button id="settingsButton" class="menuButton settings">Settings</button>
        </div>
    </div>
    <div id="settingsScreen" style="display:none;">
        <div id="settingsPanel">
            <button id="closeSettings" aria-label="Close settings">✕</button>
            <h1>Menu</h1>

            <div class="tabs">
                <button class="tabButton active" data-tab="settingsTab">Settings</button>
                <button class="tabButton" data-tab="controlsTab">Controls</button>
            </div>

            <div class="tabContent active" id="settingsTab">
                <label>
                    Mouse Sensitivity
                    <input id="sensInput" type="range" min="0.0001" max="0.03" step="0.0001" value="0.002">
                </label>

                <label>
                    <input type="checkbox" id="strafeToggle">
                    Turn on strafing for A/D
                </label>
            </div>

            <div class="tabContent" id="controlsTab">
                <div class="controlsList">
                    <div><b>W</b> — Move forward</div>
                    <div><b>S</b> — Move backward</div>
                    <div><b>A</b> — Strafe left / Turn left</div>
                    <div><b>D</b> — Strafe right / Turn right</div>
                    <div><b>Mouse</b> — Look around</div>
                    <div><b>Space</b> — Jump</div>
                    <div><b>Shift</b> — Run</div>
                    <div><b>V</b> — Toggle camera mode</div>
                    <div><b>Esc</b> — Open menu</div>
                </div>
            </div>
        </div>

    </div>
    
    <script type="text/python" id="py-grid-script">
        import numpy as np


        def wave_propagate_point_source(timesteps: int, xsize: int, ysize: int, zsize: int) -> np.ndarray:
            """
            Return a 4D numpy array of shape (timesteps, xsize, ysize, zsize).
            Simulate a simple wave propagation from a point source at the center.
            Written by MS Copilot
            """
            # Initialize the 4D array
            wave = np.zeros((timesteps, xsize, ysize, zsize), dtype=np.float32)

            # Define the center point
            cx, cy, cz = xsize // 2, ysize // 2, zsize // 2

            # Initial condition: point source at t=0
            wave[0, cx, cy, cz] = 3.0

            # Parameters for wave propagation
            c = 2.0   # wave speed
            dt = 0.1  # time step
            dx = 1.0  # spatial step
            coeff = (c * dt / dx) ** 2

            # Time evolution using finite differences
            for t in range(1, timesteps - 1):
                # Laplacian approximation (3D)
                laplacian = (
                    np.roll(wave[t], 1, axis=0) + np.roll(wave[t], -1, axis=0) +
                    np.roll(wave[t], 1, axis=1) + np.roll(wave[t], -1, axis=1) +
                    np.roll(wave[t], 1, axis=2) + np.roll(wave[t], -1, axis=2) -
                    6 * wave[t]
                )
                # Wave equation update
                wave[t+1] = 2 * wave[t] - wave[t-1] + coeff * laplacian

            return wave

        grid = wave_propagate_point_source(500, 100, 2, 100)
    </script>

    <script type="x-shader/x-vertex" id="vertexshader">
        attribute float size;
        attribute vec3 customColor;
        varying vec3 vColor;
        void main() {
            vColor = customColor;
            vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
            gl_PointSize = size * ( 300.0 / -mvPosition.z );
            gl_Position = projectionMatrix * mvPosition;
        }
    </script>

    <script type="x-shader/x-fragment" id="fragmentshader">
        uniform vec3 color;
        uniform sampler2D pointTexture;
        varying vec3 vColor;
        void main() {
            gl_FragColor = vec4( color * vColor, 1.0 );
            gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );
        }
    </script>
    <script type="module" src="__insert_game_name_here__.js"></script>
</body>
</html>