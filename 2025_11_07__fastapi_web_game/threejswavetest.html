<!DOCTYPE html>
<!-- We are probably going to delete this
 pretty soon. -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voxel EM Wave Visualization</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.120.1/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.120.1/examples/js/controls/OrbitControls.js"></script>

<script>
const sizeX = 16, sizeY = 16, sizeZ = 16; // keep small for performance
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 100);
camera.position.set(30,30,30);

const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);

// group to hold voxels
const voxelGroup = new THREE.Group();
scene.add(voxelGroup);

for (let x = 0; x < sizeX; x++) {
  for (let y = 1; y < sizeY; y++) { // avoid division by zero
    for (let z = 0; z < sizeZ; z++) {
      const X = (x / sizeX) * Math.PI * 2;
      const Y = (y / sizeY) * Math.PI * 2;
      const Z = (z / sizeZ) * Math.PI * 2;
      const intensity = Math.sin(Z) * Math.sin(X) / Y;

      // map intensity to color and opacity
      const color = new THREE.Color().setHSL(0.6 - intensity*0.3, 1.0, 0.5);
      const opacity = Math.min(Math.abs(intensity), 1.0);

      if (opacity > 0.05) { // skip very transparent voxels
        const material = new THREE.MeshBasicMaterial({
          color: color,
          transparent: true,
          opacity: opacity
        });
        const cube = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), material);
        cube.position.set(x - sizeX/2, y - sizeY/2, z - sizeZ/2);
        voxelGroup.add(cube);
      }
    }
  }
}

function animate() {
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
